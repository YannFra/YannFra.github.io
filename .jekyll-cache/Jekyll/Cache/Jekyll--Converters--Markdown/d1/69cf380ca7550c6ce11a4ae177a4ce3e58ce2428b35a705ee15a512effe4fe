I"ãî<p>You have a dataset. How do you plot this dataset into a website? Well guess what, here again Python can do all of that. From opening the dataset to creating a webpage including the interactive plot you did, there is nothing Python cannot do!</p>

<p>This tutorial/example will go through all the steps required to go from the dataset to inserting your dynamic plot in a webpage. We will be plotting the bikeways in San Francisco over the city‚Äôs streets. The questions this example answers are:</p>
<ul>
  <li>How do you open and plot a geospatial database ? We will use GeoPandas to open a shapefile db (.shp).</li>
  <li>How do you make this plot interact with the user ? We will use Bokeh to create the interactive plot.</li>
  <li>How do you create a webpage including this plot ? We will use Flask to do so.</li>
</ul>

<p>A lot of tutorials show how to do each of these parts independently. The goal of this tutorial is to include all of them into one example on the Bike Lanes network in San Francisco. The Python code used can be found in this <a href="https://github.com/YannFra/Website-Flask-Bokeh-Geopandas">GitHub</a> and the explanations in this <a href="https://yannfra.github.io/Creating-Website-Flask-Bokeh-GeoPandas/">tutorial</a>. Please contact me if you encounter any issue.</p>

<p>Python libraries used in this tutorial: <a href="https://docs.bokeh.org/en/latest/">Bokeh</a>,<a href="https://www.fullstackpython.com/flask.html">Flask</a>, and <a href="http://geopandas.org">GeoPandas</a></p>

<p>Our example will be on the bike network in San Francisco. Where are the bike lanes in San Francisco ? Is there enough of them to commute in bike ? We will create a plot that superimposes the bike lanes network to the street network in San Francisco. Then we will allow the user to zoom this plot and to hide/show the desired networks.</p>

<p>This work was possible thanks to :</p>
<ul>
  <li><a href="https://datasf.org">DataSF</a> that has a lot of Open Access datasets. We used the one they give on the <a href="https://data.sfgov.org/Transportation/SFMTA-Bikeway-Network/ygmz-vaxd">bike lanes in San Francisco</a>.</li>
  <li><a href="https://www.data.gov">Data.gov</a> that also has a lot of open Access datasets. We used the one they give on the <a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2017-county-san-francisco-county-ca-all-roads-county-based-shapefile">streets in San Francisco</a></li>
</ul>

<h2 id="0-downloading-the-datasets">0. Downloading the datasets</h2>

<p>Create a ‚Äúdata‚Äù folder for the datasets and a ‚Äútemplates‚Äù for the plots we are going to create.</p>

<p>Do not forget to download and unzip the datasets in ‚Äúdata‚Äù:</p>
<ul>
  <li>The Bike Lanes in San Francisco dataset from <a href="https://data.sfgov.org/Transportation/SFMTA-Bikeway-Network/ygmz-vaxd">DataSF</a>.</li>
  <li>The Streets in San Francisco dataset from <a href="https://catalog.data.gov/dataset/tiger-line-shapefile-2017-county-san-francisco-county-ca-all-roads-county-based-shapefile">Data.gov</a></li>
</ul>

<p>Instead of doing all this, you can run <code class="highlighter-rouge">upload_dataset</code>, a code doing all of that for you.</p>

<p>To be sure we are using the same libraries versions, please download the <code class="highlighter-rouge">requirements.txt</code> file in the <a href="https://github.com/YannFra/Website-Flask-Bokeh-Geopandas">GitHub</a> and do <code class="highlighter-rouge">pip install -r requirements.txt</code> in your terminal.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">upload_dataset</span></code></pre></figure>

<h2 id="1-how-to-plot-shapefile-databases-shp-using-geopandas">1. How to plot shapefile databases (.shp) using GeoPandas?</h2>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#Uploading the shapefiles
</span><span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="n">gpd</span>

<span class="n">db_bike_path</span><span class="o">=</span><span class="s">"data/geo_export_0ff3043a-1833-476b-afe0-779dfa091ebd.shp"</span>
<span class="n">db_bike</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">db_bike_path</span><span class="p">)</span>

<span class="n">db_roads_path</span><span class="o">=</span><span class="s">"data/tl_2017_06075_roads.shp"</span>
<span class="n">db_roads</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">db_roads_path</span><span class="p">)</span>

<span class="n">db_bike</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">db_roads</span><span class="o">.</span><span class="n">columns</span></code></pre></figure>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(Index(['barrier', 'biap', 'buffered', 'cnn', 'contraflow', 'created_da',
        'created_us', 'dir', 'direct', 'double', 'facility_t', 'from_st', 'fy',
        'globalid', 'greenwave', 'install_mo', 'install_yr', 'last_edite',
        'length', 'notes', 'number_', 'qtr', 'raised', 'sharrow', 'sm_sweeper',
        'street_', 'streetname', 'surface_tr', 'symbology', 'to_st',
        'update_mo', 'update_yr', 'geometry'],
       dtype='object'),
 Index(['LINEARID', 'FULLNAME', 'RTTYP', 'MTFCC', 'geometry'], dtype='object'))
</code></pre></div></div>

<p><code class="highlighter-rouge">read_file</code> reads any .shp file without any problem. The column having the geospatial information needs to be called <code class="highlighter-rouge">geometry</code>. Thic convention is respected but remember to check it if you get an error message stating that the column <code class="highlighter-rouge">geometry</code> is missing.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#Plotting the databases
</span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>

<span class="n">db_roads</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"gray"</span><span class="p">)</span>
<span class="n">db_bike</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'equal'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">'off'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></code></pre></figure>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;Figure size 1000x1000 with 1 Axes&gt;
</code></pre></div></div>

<p>As you can see, a few lines of code are enough to read and plot a shapefile database without breaking any sweat. The rest is just knowing how to use Matplotlib.</p>

<p>Now let‚Äôs consider you want the user being able to zoom the graph or to hide/show the ‚ÄúBike Lanes‚Äù at any time. In that case, GeoPandas will not be enough as you can only create static plot with it. Don‚Äôt worry, there is an alternative. Let‚Äôs use Bokeh!</p>

<h2 id="how-to-make-an-interactive-plot-using-bokeh">How to make an interactive plot using Bokeh?</h2>

<p>Bokeh is a very interesting Python library you can do a lot of stuff with. I advise to take a look at <a href="http://docs.bokeh.org/en/1.3.2/docs/gallery.html">Bokeh‚Äôs gallery</a> and look at all their fancy examples. Bokeh advantages are:</p>

<ul>
  <li>handling the JavaScript part of the plot that makes it interactive with some lines of code in Python</li>
  <li>connecting sliders, buttons, and many others objects that can change your plot when the user plays with them</li>
  <li>beautiful default design settings</li>
</ul>

<p>First, let‚Äôs plot with Bokeh the same plot as before.</p>

<p>To do so, we first need to know what kind of spatial element we are plotting.</p>
<ul>
  <li><code class="highlighter-rouge">Point</code>(or <code class="highlighter-rouge">Multi-Points</code>) can be plotted with <code class="highlighter-rouge">.circle</code></li>
  <li><code class="highlighter-rouge">Line</code>(or <code class="highlighter-rouge">Multi-Lines</code>) can be plotted with <code class="highlighter-rouge">.multi_line</code></li>
  <li><code class="highlighter-rouge">Polygon</code>(or <code class="highlighter-rouge">Multi-Polygons</code>) can be plotted with <code class="highlighter-rouge">.patch</code></li>
</ul>

<p>As it can be seen bellow, in the two databases, we are working with <code class="highlighter-rouge">Line</code>(or <code class="highlighter-rouge">Multi-Lines</code>). Therefore, we will be using <code class="highlighter-rouge">.multi_line</code> to plot our database. For more details, the best is to look at the tutorial made on the plotting topic by <a href="https://docs.bokeh.org/en/latest/docs/reference/plotting.html">Bokeh</a> and/or by <a href="https://automating-gis-processes.github.io/2016/Lesson5-interactive-map-bokeh.html">GeoPandas</a></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">db_bike</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="nb">type</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span><span class="n">db_roads</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="nb">type</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="p">(</span><span class="n">array</span><span class="p">([</span><span class="s">'LineString'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">array</span><span class="p">([</span><span class="s">'LineString'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#Libraries for Dynamic Vizualisation
</span><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_file</span><span class="p">,</span><span class="n">show</span><span class="p">,</span><span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">GeoJSONDataSource</span>

<span class="c1">#To display in the notebook your Bokeh Plot
</span><span class="n">output_notebook</span><span class="p">()</span>

<span class="c1">#SF, San Francisco, will be the figure containing the plots.
</span><span class="n">SF</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">aspect_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">match_aspect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#Bokeh can only plot json db
#GeoJSONDataSource tsakes care of the conversion
</span><span class="n">db_roads_json</span><span class="o">=</span><span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">db_roads</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
<span class="n">multi_line_all</span><span class="o">=</span><span class="n">SF</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="s">'xs'</span><span class="p">,</span> <span class="s">'ys'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">db_roads_json</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">"gray"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="s">"All streets"</span><span class="p">)</span>

<span class="n">db_bike_json</span><span class="o">=</span><span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">db_bike</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
<span class="n">multi_line_bike</span><span class="o">=</span><span class="n">SF</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="s">'xs'</span><span class="p">,</span> <span class="s">'ys'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">db_bike_json</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="s">"Bike Lanes"</span><span class="p">)</span>

<span class="c1">#Hide axis and grid
</span><span class="n">SF</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span>
<span class="n">SF</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">SF</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">show</span><span class="p">(</span><span class="n">SF</span><span class="p">)</span>
<span class="c1">#enables you to save a stand alone plot as a html page
</span><span class="n">output_file</span><span class="p">(</span><span class="s">"templates/SF_plot.html"</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;div class="bk-root"&gt;
    &lt;a href="https://bokeh.pydata.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"&gt;&lt;/a&gt;
    &lt;span id="1861"&gt;Loading BokehJS ...&lt;/span&gt;
&lt;/div&gt;
</code></pre></div></div>

<div class="bk-root" id="95eaec1b-ebaf-44a6-9ae9-6f5ac991c11f" data-root-id="1862"></div>

<p>As you can see, we have recreated the same plot as the one done with GeoPandas and Matplotlib. We have actually a bit cheated. You can see, in the top right, icons. Those icons are coming by default with your Bokeh plot and can be removed. Each icon has a built-in function associated. E.g. The second and third one from the top are for different kinds of zooms.You can only use an icon at a time. Try them out !</p>

<p>Let‚Äôs now create two checkboxes with <code class="highlighter-rouge">CheckboxGroup</code>. One for ‚ÄúBike Lanes‚Äù and one for ‚ÄúAll strets‚Äù. We want them to hide/show the associated curve when the user click on them.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bokeh.models.widgets</span> <span class="kn">import</span> <span class="n">CheckboxGroup</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span>  <span class="n">row</span>

<span class="n">checkbox_choices</span> <span class="o">=</span> <span class="n">CheckboxGroup</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">"All streets"</span><span class="p">,</span> <span class="s">"Bike Lanes"</span><span class="p">],</span> 
    <span class="n">active</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)])</span>

<span class="n">layout</span><span class="o">=</span><span class="n">row</span><span class="p">(</span><span class="n">SF</span><span class="p">,</span><span class="n">checkbox_choices</span><span class="p">)</span>

<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
<span class="n">output_file</span><span class="p">(</span><span class="s">"templates/SF_plot_widgets.html"</span><span class="p">)</span></code></pre></figure>

<div class="bk-root" id="eef12c51-394f-438a-b002-9387c8d1d4d4" data-root-id="1143"></div>

<p>The checkboxes are currently standing alone and clicking on them will do nothing. Try it !</p>

<p>You could connect the checkboxes with a code in Python and Bokeh would take care of the conversion of this code into JavaScript. That sounds perfect. Unfortunately, this conversion requires having a Bokeh server running alongside your plot which is everything but convenient. Do not worry, Bokeh developers are really smart and they allow you to put in your code pieces of JavaScript that will take care of the connection between the checkboxes and the plot. This is what we are going to do. As a non JavaScript lover, I can promise you that the JS part will be very small and simple. However your JS code will depend of your project and the number of widgets you want to connect to your plot.</p>

<p>Creating the plot ineractivity requires:</p>
<ul>
  <li>a dictionary with all the elements included in the interactivity. Here it will be our two <code class="highlighter-rouge">multi_line</code> and our checkboxes.</li>
  <li>a JS code monitoring the interactivity. Whenever you call the elements in the interactivity use the same names as the one given in the dictionary</li>
  <li>make a callback on the objects that will be clicked by the user with the dictionnary and the JS code.</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">CustomJS</span>

<span class="n">update_elements</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">curves</span><span class="o">=</span><span class="p">[</span><span class="n">multi_line_all</span><span class="p">,</span><span class="n">multi_line_bike</span><span class="p">],</span>
    <span class="n">check</span><span class="o">=</span><span class="n">checkbox_choices</span><span class="p">)</span>

<span class="n">updatingJS</span><span class="o">=</span><span class="s">"""
    var coefs=check.active;
    
    for (var i = 0; i&lt;= coefs.length; i++){
        console.log(coefs.includes(i))
        if (coefs.includes(i)){
            curves[i].visible=true;
        }
        else{
            curves[i].visible=false;
        }
    }    
"""</span>
<span class="n">checkbox_choices</span><span class="o">.</span><span class="n">callback</span><span class="o">=</span><span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="n">update_elements</span><span class="p">,</span><span class="n">code</span><span class="o">=</span><span class="n">updatingJS</span><span class="p">)</span>

<span class="n">layout</span><span class="o">=</span><span class="n">row</span><span class="p">(</span><span class="n">SF</span><span class="p">,</span><span class="n">checkbox_choices</span><span class="p">)</span>

<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
<span class="n">output_file</span><span class="p">(</span><span class="s">"templates/SF_plot_widgets_connected.html"</span><span class="p">)</span></code></pre></figure>

<div class="bk-root" id="f3c3710c-9c7c-49aa-84a5-e8b93efbf2e1" data-root-id="1366"></div>

<p>Here we are. We have a dynamic plot. The user can decide what plot to see and can also zoom to some specific neighbor of San Francsico.</p>

<p>These checkboxes were actually an excuse to show you how everything works for your own project. In case you are interested into hiding/showing a plot at will, Bokeh already has a function in Python that can do this. Thank you Bokeh ! You can find the code for our example below. Click on <code class="highlighter-rouge">bikeways</code> or <code class="highlighter-rouge">streets</code> in the legend to hide/show the associated plot in the figure.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c1">#Libraries for Dynamic Vizualisation
</span><span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_file</span><span class="p">,</span><span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">GeoJSONDataSource</span>


<span class="n">SF</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">aspect_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">match_aspect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">db_roads_json</span><span class="o">=</span><span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">db_roads</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
<span class="n">multi_line_all</span><span class="o">=</span><span class="n">SF</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="s">'xs'</span><span class="p">,</span> <span class="s">'ys'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">db_roads_json</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">"gray"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="s">"All streets"</span><span class="p">)</span>

<span class="n">db_bike_json</span><span class="o">=</span><span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">db_bike</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
<span class="n">multi_line_bike</span><span class="o">=</span><span class="n">SF</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="s">'xs'</span><span class="p">,</span> <span class="s">'ys'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">db_bike_json</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="s">"Bike Lanes"</span><span class="p">)</span>

<span class="n">SF</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s">"hide"</span>

<span class="c1">#Hide axis and grid
</span><span class="n">SF</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">visible</span><span class="o">=</span><span class="bp">False</span>
<span class="n">SF</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">SF</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>

<span class="n">show</span><span class="p">(</span><span class="n">SF</span><span class="p">)</span>
<span class="n">output_file</span><span class="p">(</span><span class="s">"templates/SF_plot_legend.html"</span><span class="p">)</span></code></pre></figure>

<div class="bk-root" id="887a1cd9-5ee1-4be0-9a85-f5e6eb4bcec0" data-root-id="1577"></div>

<p>Now that are in possession of this interactive plot, let‚Äôs make it available to the users in a website.</p>

<p>Go back to the <a href="https://yannfra.github.io/Creating-Website-Flask-Bokeh-GeoPandas/">tutorial webpage</a> to see how to do this.</p>

<h2 id="3-how-to-put-a-bokeh-plot-into-a-website">3. How to put a Bokeh plot into a website?</h2>

<p>We have a running plot in Bokeh. Dynamic or static, complex or simple, it does not matter the process will be the same. It does not even need to be a Bokeh plot. However, before making a website, given that you have many options, you first need to evaluate your needs.</p>
<ol>
  <li>You can create a webpage with only your plot. If you go into the ‚Äútemplates‚Äù folder, you will find all the dynamic plots we have created saved with a HTML format file extension.
    <ul>
      <li>Your plot will be standing alone</li>
      <li>Your website will not run in Python</li>
      <li>You just need in your current website to make a redirection to the plot when you want your reader to read it.</li>
    </ul>
  </li>
  <li>You can create a webpage where your plot is surrounded by text and other plots. We will be using Flask to do this.
    <ul>
      <li>Flask is very simple to set up</li>
      <li>Your website will use Python</li>
      <li>You can set up an authentication system (flask-login)</li>
    </ul>
  </li>
</ol>

<p>In the previous section, we already saw how to save the dynamic plot as an HTML file. Therefore, we are now only going to work on point 2. Let‚Äôs s use Flask. I hope you will be as amazed as I was to notice how easy it is to make a website with Flask.</p>

<p>How does Flask work ? You still need an HTML page. However Flask is going to convert for you the plot into HTML and JS. One additional interest of Flask is that you can develop your website with Python but also with HTML, CSS and JS. It is pretty convenient for designing the website. Here is the <a href="https://www.freecodecamp.org/news/how-to-build-a-web-application-using-flask-and-deploy-it-to-the-cloud-3551c985e492/">link</a> of a simple tutorial made by Flask developers.</p>

<p>We are going to create :</p>
<ul>
  <li><code class="highlighter-rouge">app.py</code> that will have the python script inserting our plot</li>
  <li><code class="highlighter-rouge">base.html</code> in the templates repository that will contain our website.</li>
</ul>

<p>You can also see the desired structure in the <a href="https://github.com/YannFra/Website-Flask-Bokeh-Geopandas">project GitHub</a>.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"UTF-8"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://www.w3schools.com/w3css/4/w3.css"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{{url_for('static', filename='css/main.css')}}"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://code.jquery.com/jquery-3.1.0.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
	<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"{{ url_for('static', filename='js/main.js')}}"</span><span class="nt">&gt;&lt;/script&gt;</span>
	{{ js_resources | safe}}
	{{ css_resources | safe}}
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
{{ script | safe }}
{{ div | safe }}
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span></code></pre></figure>

<p>What you see in brackets is what Flask is going to give to the HTML file to display the plot.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>

<span class="c1">#Application that is running the website
</span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="o">@</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s">"/"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">index</span><span class="p">():</span>
    
    <span class="c1">#Downloading the datasets
</span>    <span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="n">gpd</span>
    
    <span class="n">db_bike_path</span><span class="o">=</span><span class="s">"data/geo_export_0ff3043a-1833-476b-afe0-779dfa091ebd.shp"</span>
    <span class="n">db_bike</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">db_bike_path</span><span class="p">)</span>
    
    <span class="n">db_roads_path</span><span class="o">=</span><span class="s">"data/tl_2017_06075_roads.shp"</span>
    <span class="n">db_roads</span><span class="o">=</span><span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">db_roads_path</span><span class="p">)</span>
    
    
    <span class="c1">#Plotting the bike lanes and the streets
</span>    <span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span>
    <span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">GeoJSONDataSource</span>
    <span class="kn">from</span> <span class="nn">bokeh.embed</span> <span class="kn">import</span> <span class="n">components</span>
    <span class="kn">from</span> <span class="nn">bokeh.resources</span> <span class="kn">import</span> <span class="n">INLINE</span>
    <span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">render_template</span>

    <span class="n">SF</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">aspect_scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">match_aspect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="n">db_roads_json</span><span class="o">=</span><span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">db_roads</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
    <span class="n">SF</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="s">'xs'</span><span class="p">,</span> <span class="s">'ys'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">db_roads_json</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s">"gray"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="s">"All streets"</span><span class="p">)</span>
    
    <span class="n">db_bike_json</span><span class="o">=</span><span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">db_bike</span><span class="o">.</span><span class="n">to_json</span><span class="p">())</span>
    <span class="n">SF</span><span class="o">.</span><span class="n">multi_line</span><span class="p">(</span><span class="s">'xs'</span><span class="p">,</span> <span class="s">'ys'</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">db_bike_json</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s">"red"</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">legend</span><span class="o">=</span><span class="s">"Bike Lanes"</span><span class="p">)</span>
    
    <span class="n">SF</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s">"hide"</span>
    
    
    <span class="c1">#Convert the plot into HTML and JS that can be read by base.html
</span>    <span class="n">script_plot</span><span class="p">,</span><span class="n">div_plot</span><span class="o">=</span><span class="n">components</span><span class="p">(</span><span class="n">SF</span> <span class="p">,</span><span class="n">INLINE</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s">'plot.html'</span><span class="p">,</span>
                       <span class="n">script</span><span class="o">=</span><span class="n">script_plot</span><span class="p">,</span>
                       <span class="n">div</span><span class="o">=</span><span class="n">div_plot</span><span class="p">,</span>
                       <span class="n">js_resources</span><span class="o">=</span><span class="n">INLINE</span><span class="o">.</span><span class="n">render_js</span><span class="p">(),</span>
                       <span class="n">css_resources</span><span class="o">=</span><span class="n">INLINE</span><span class="o">.</span><span class="n">render_css</span><span class="p">())</span>


<span class="c1">#Make the website work when we run this python file
</span><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'0.0.0.0'</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8000</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>With his method, your website is now running in local. It might be enough for your need. In case it is not, here are two different tutorials to make your website global:</p>
<ul>
  <li><a href="https://www.freecodecamp.org/news/how-to-build-a-web-application-using-flask-and-deploy-it-to-the-cloud-3551c985e492/">Here</a> is the tutorial done by Flask developer to make a website and then upload it to the cloud using <a href="https://cloud.google.com/appengine/">Google App Engine</a>.</li>
  <li><a href="https://www.digitalocean.com/community/tutorials/how-to-serve-flask-applications-with-gunicorn-and-nginx-on-ubuntu-16-04">Here</a> is a great tutorial done by Digital Ocean helping you put on the cloud your website on <a href="https://aws.amazon.com">AWS</a>.</li>
</ul>

<p>Unless you have a special reason I would recommend following Flask developers tutorial to upload your website to the cloud. It will be much simpler.</p>

<p>Hope this tutorial was helpful and will help your personal projects !</p>

:ET